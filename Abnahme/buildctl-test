pipeline{
    agent any
    stages {
        stage('test buildctl') {
            agent any
            steps {
                withCredentials([gitUsernamePassword(credentialsId: 'gitJWId', gitToolName: 'Default')]) {
                   def result = sh 'curl -sSLf https://github.com/moby/buildkit/releases/download/v0.10.0/buildkit-v0.10.0.linux-amd64.tar.gz | sudo tar -xz -C /usr/local/bin/ --strip-components=1'
                   deleteDir()
                   sh '''
                   sudo buildkitd &
                   buildctl build --help
                   '''
                }
           }
        }
    }
    post {
        always {
            deleteDir()
        }
    }
}
